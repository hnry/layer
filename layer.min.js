// Copyright 2013 lovebear https://github.com/lovebear/layer.js
"use strict";var layer={};layer.environment="browser","undefined"!=typeof module&&module.exports&&(layer.environment="nodejs"),layer._default_context=this,"nodejs"===layer.environment&&(layer._default_context=module.parent.exports),layer._context_level=3,layer._find_context=function(e,t,r){for(var n=Object.keys(e),o=0,l=n.length;l>o;o++){var i=e[n[o]];if(i&&i===t)return[e,n[o]]}if(0===r)throw Error("Unable to find context");return this._find_context(e,t,r-1)},layer.Stop=function(){},layer.set=function(e,t,r){var n=!1;e||(e=layer._default_context);var o=this._find_context(e,t,this._context_level);if(o){var l=o[0][o[1]];o[0][o[1]]=function(){var e=r.apply(o[0],Array.prototype.slice.call(arguments));if(e&&!(e instanceof layer.Stop)){e=Array.prototype.slice.call(e);var t=l.apply(o[0],e);if(t)return t}},o[0][o[1]].skip=l,o[0][o[1]].skip._context=o[0],n=!0}if(!n)throw Error("Could not set proxy")},layer.unset=function(e){var t=!1,r=e.skip;if(e.skip&&e.skip._context){var n=this._find_context(e.skip._context,e,this._context_level);n&&(r._context&&delete r._context,n[0][n[1]]=r,t=!0)}if(!t)throw Error("Could not unset proxy")},layer.replace=function(e,t,r){var n=!1,o=this._find_context(e,t,this._context_level);if(o&&(o[0][o[1]]=r,n=!0),!n)throw Error("Could not replace function")},"nodejs"===layer.environment&&(module.exports=layer);