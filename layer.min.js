// Copyright 2013 lovebear https://github.com/lovebear/layer.js
"use strict";var layer={};"undefined"!=typeof module&&module.exports&&(layer._isNode=!0),layer._default_context=layer._isNode?{}:this,layer._find_context=function(e,t){for(var r=Object.keys(e),a=0,o=r.length;o>a;a++){var l=e[r[a]];if(l&&l===t)return[e,r[a]]}throw Error("Unable to find context")},layer.Stop=function(){},layer._call=function(e,t,r){var a,o=r&&r.length||0;switch(o){case 0:a=t.call(e);break;case 1:a=t.call(e,r[0]);break;case 2:a=t.call(e,r[0],r[1]);break;case 3:a=t.call(e,r[0],r[1],r[2]);break;default:a=t.apply(e,r)}return a},layer.set=function(e,t,r){var a=!1;e||(e=layer._default_context);var o=this._find_context(e,t,this._context_level);if(o){var l=o[0][o[1]];o[0][o[1]]=function(){var e=layer._call(o[0],r,arguments);if(!(e&&e instanceof layer.Stop)){var t;if(!Array.isArray(e)&&e&&(e=[e]),t=layer._call(o[0],l,e))return t}},o[0][o[1]].skip=l,o[0][o[1]].skip._context=o[0],a=!0}if(!a)throw Error("Could not set proxy")},layer.unset=function(e){var t=!1,r=e.skip;if(e.skip&&e.skip._context){var a=this._find_context(e.skip._context,e,this._context_level);a&&(r._context&&delete r._context,a[0][a[1]]=r,t=!0)}if(!t)throw Error("Could not unset proxy")},layer.replace=function(e,t,r){var a=!1,o=this._find_context(e,t,this._context_level);if(o&&(o[0][o[1]]=r,a=!0),!a)throw Error("Could not replace function")},layer._isNode&&(module.exports=layer);